<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="global.sesoc.ConsolGame.dao.GameListMapper">


	
	<resultMap type="ConsolGame" id="ConsolGame">
		<result column="gamenum" property="gamenum" />
		<result column="gametitle" property="gametitle" />
		<result column="production" property="production" />
		<result column="content" property="content" />
		<result column="imageurl" property="imageurl" />
		<result column="genre" property="genre" />
		<result column="typename" property="typename" />
	</resultMap>
	
	<resultMap type="ConsolGame" id="ConsolGamel">
		<result column="gamenum" property="gamenum" />
		<result column="gametitle" property="gametitle" />
		<result column="production" property="production" />
		<result column="content" property="content" />
		<result column="imageurl" property="imageurl" />
		<result column="genre" property="genre" />
		<result column="typename" property="typename" />
		<collection property="lend" resultMap="LendConsol" />
	</resultMap>
		
	<resultMap type="ConsolUser" id="ConsolUser">
		<result column="usernum" property="usernum" />
		<result column="userid" property="userid" />
		<result column="userpwd" property="userpwd" />
		<result column="birthdate" property="birthdate" />
		<result column="username" property="username" />
		<result column="email" property="email" />
		<result column="tel1" property="tel1" />
		<result column="tel2" property="tel2" />
		<result column="tel3" property="tel3" />
		<result column="imageurl" property="imageurl" />
		<result column="point" property="point" />
		<result column="userlevel" property="userlevel" />
	</resultMap>
	
	<resultMap type="ConsolUser" id="ConsolUserl">
		<result column="usernum" property="usernum" />
		<result column="userid" property="userid" />
		<result column="userpwd" property="userpwd" />
		<result column="birthdate" property="birthdate" />
		<result column="username" property="username" />
		<result column="email" property="email" />
		<result column="tel1" property="tel1" />
		<result column="tel2" property="tel2" />
		<result column="tel3" property="tel3" />
		<result column="imageurl" property="imageurl" />
		<result column="point" property="point" />
		<result column="userlevel" property="userlevel" />
		<collection property="lend" resultMap="LendConsol" />

	</resultMap>
	
	
	<resultMap type="LendConsol" id="LendConsol">
		<result column="lend" property="lend" />
		<result column="usernum" property="usernum" />
		<result column="startdate" property="startdate" />
		<result column="enddate" property="enddate" />
		<result column="returndate" property="returndate" />
		<result column="status" property="status" />
		<result column="gamenum" property="gamenum" />
	</resultMap>
	
	<resultMap type="LendConsol" id="LendConsolg">
		<result column="lend" property="lend" />
		<result column="usernum" property="usernum" />
		<result column="startdate" property="startdate" />
		<result column="enddate" property="enddate" />
		<result column="returndate" property="returndate" />
		<result column="status" property="status" />
		<result column="gamenum" property="gamenum" />
		<collection property="game" resultMap="ConsolGame" />
	</resultMap>
	<resultMap type="LendConsol" id="LendConsolu">
		<result column="lend" property="lend" />
		<result column="usernum" property="usernum" />
		<result column="startdate" property="startdate" />
		<result column="enddate" property="enddate" />
		<result column="returndate" property="returndate" />
		<result column="status" property="status" />
		<result column="gamenum" property="gamenum" />
		<collection property="user" resultMap="ConsolUser" />
	</resultMap>
	
	<resultMap type="LendConsol" id="LendConsolug">
		<result column="lend" property="lend" />
		<result column="usernum" property="usernum" />
		<result column="startdate" property="startdate" />
		<result column="enddate" property="enddate" />
		<result column="returndate" property="returndate" />
		<result column="status" property="status" />
		<result column="gamenum" property="gamenum" />
		<collection property="user" resultMap="ConsolUser" />
		<collection property="game" resultMap="ConsolGame" />
	</resultMap>
	
	
	<select id="selectAll" parameterType="map" resultMap="ConsolGamel">
		select
		gamenum,
		gametitle,
		production,
		content,
		imageurl,
		genre,
		typename,
		status
		from consolgame left join lendconsol using (GAMENUM)
		<if test="searchList != null">
			WHERE ${searchList} LIKE '%'||#{searchItem}||'%'
		</if>
	</select>


	<select id="selectOneGame" parameterType="ConsolGame" resultMap="ConsolGamel">
		select
		gamenum,
		gametitle,
		production,
		content,
		imageurl,
		genre,
		typename,
		status
		from consolgame left join lendconsol using (GAMENUM)
		where
		gamenum = #{gamenum}
	</select>


	<insert id="reQuestlendGame" parameterType="LendConsol">
		insert into
		lendconsol
		(
		lend,
		usernum,
		status,
		gamenum
		)
		values
		(
		lend_seq.nextval,
		#{usernum},
		#{status},
		#{gamenum}
		)

	</insert>


	<select id="RequestList" parameterType="map" resultMap="LendConsolug">
		select
		*
		from consolgame join LendConsol using (GAMENUM)
            left outer join ConsolUser using(usernum)
		WHERE
		status ='reserved'
		<if test="searchList != null">
			and ${searchList} LIKE '%'||#{searchItem}||'%'
		</if>
		order by lend asc
	</select>

	<update id="confirmRequest" parameterType="map">
	update LendConsol
	set
	STATUS = #{lendConsol.status}
	<if test="lendConsol.status == 'lent'">
	,STARTDATE = sysdate
	,ENDDATE = sysdate + #{selectDate}
	</if>
	WHERE
	lend =#{lendConsol.lend}
	</update>
	
	
	<select id="selectlentGame" parameterType="LendConsol" resultType="LendConsol">
	SELECT
	GAMENUM
	FROM
	LendConsol
	WHERE
	lend =#{lend}
	</select>
	
	<update id="chaingOtherRequest" parameterType="LendConsol">
	update LendConsol
	set
	STATUS = 'rejected'
	WHERE
	gamenum = #{gamenum} and STATUS = 'reserved'
	</update>
</mapper>